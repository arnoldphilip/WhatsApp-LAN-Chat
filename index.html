<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LANChat</title>
    <link rel="stylesheet" href="node_modules/cropperjs/dist/cropper.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container" id="chat-container">
        <div class="header" id="title">
            LANChat
            <div class="header-controls" style="display:flex; gap:10px;">
                <button id="admin-toggle-btn"
                    style="display:none; font-size:18px; padding:5px; background:var(--border-subtle); border-radius:50%;"
                    title="Admin Tools" onclick="toggleAdminPanel()">‚öôÔ∏è</button>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="admin-panel" class="req-box"
            style="display:none; background:var(--header-bg); border-bottom:1px solid var(--border-subtle); padding:10px; animation: slideDown 0.3s ease;">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="margin:0; font-size:16px;">Admin Controls</h3>
                <button onclick="toggleAdminPanel()" style="font-size:12px; padding:2px 6px;">‚úñ</button>
            </div>

            <div id="requests-section"
                style="display:none; margin-top:10px; border-top:1px solid var(--border-subtle); padding-top:10px;">
                <h4 style="margin:5px 0 10px 0; font-size:14px; color:var(--success); font-weight:600;">Pending Requests
                </h4>
                <div id="requests"></div>
            </div>

            <div id="members-section"
                style="margin-top:15px; border-top:1px solid var(--border-subtle); padding-top:10px;">
                <h4 style="margin:5px 0 10px 0; font-size:14px; color:var(--text-primary); font-weight:600;">Members
                </h4>
                <div id="members-list"></div>
            </div>

            <div id="admin-actions" style="margin-top:15px; text-align:right;">
                <!-- End Session button will be here -->
            </div>
        </div>

        <ul id="chat"></ul>
        <div id="waiting" style="display:none; text-align:center; padding:10px;">‚åõ Awaiting Admin...</div>

        <div class="input-area" id="login-area">
            <input id="name" placeholder="Name">
            <button onclick="join()">Join</button>
        </div>
        <div class="reply-preview" id="reply-preview" style="display:none;">
            <div class="reply-content" onclick="scrollToReplyOrigin()">
                <span id="reply-to-name" class="reply-name"></span>
                <span id="reply-to-text" class="reply-text"></span>
            </div>
            <button onclick="cancelReply()" class="close-reply">√ó</button>
        </div>
        <div class="input-area" id="msg-area" style="display:none;">
            <!-- EMOJI BUTTON (üòÄ) and FILE INPUT (üìé) buttons are here -->
            <button class="emoji-btn" onclick="toggleEmojiPicker(event)">üòÄ</button>
            <button onclick="document.getElementById('file-input').click()">üìé</button>
            <input type="file" id="file-input" hidden accept="image/*,video/*" onchange="sendFileHandler(this)">
            <input id="msg" placeholder="Message or Emoji..." onkeydown="if(event.key==='Enter') send()">
            <button onclick="send()" title="Send">
                <svg viewBox="0 0 24 24" width="24" height="24">
                    <path fill="currentColor"
                        d="M1.101,21.757L23.8,12.028L1.101,2.3L1.1,8.105L15.306,12.028L1.1,15.95L1.101,21.757Z"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- Drop area overlay for better UX during drag/drop -->
    <div id="drop-area-overlay"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10; justify-content:center; align-items:center; color:white; font-size:24px; pointer-events:none;">
        Drop files anywhere to upload
    </div>

    <script src="/socket.io/socket.io.js"></script>
    <!-- Image Editor Modal -->
    <div id="image-editor-modal" class="modal-overlay">
        <div class="editor-container">
            <img id="image-preview">
        </div>
        <div class="editor-controls">
            <button onclick="cropImage()" class="primary-action">Crop & Send</button>
            <button onclick="sendOriginal()" class="secondary-action">Send Original</button>
            <button onclick="cancelImage()" class="danger-action">Cancel</button>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="password-modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:50; justify-content:center; align-items:center;">
        <div class="modal-content">
            <h3>Enter Admin Password</h3>
            <input type="password" id="admin-password" placeholder="Password">
            <button onclick="submitPassword()">Login</button>
            <button onclick="closePasswordModal()" class="cancel-btn">Cancel</button>
        </div>
    </div>

    <!-- Logout Modal -->
    <div id="logout-modal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:50; justify-content:center; align-items:center;">
        <div class="modal-content">
            <h3>Logout Options</h3>
            <div id="logout-options-container" style="display:flex; flex-direction:column; gap:10px; margin-top:15px;">
                <button onclick="logoutSelf()" class="logout-self-btn" style="width:100% !important;">Logout
                    Yourself</button>
                <div id="admin-logout-options" style="display:none; flex-direction:column; gap:10px;">
                    <button onclick="logoutAll()" class="end-session-btn" style="width:100% !important;">Logout
                        Everyone</button>
                </div>
                <button onclick="closeLogoutModal()" class="cancel-btn" style="margin-left:0;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Custom Context Menu -->
    <div id="custom-context-menu" class="context-menu" style="display:none; position:fixed; z-index:5000;">
        <div id="ctx-reply" class="context-menu-item" onclick="triggerReplyFromContext()">‚Ü©Ô∏è Reply</div>
        <div id="ctx-delete" class="context-menu-item" onclick="showDeleteConfirm()">üóëÔ∏è Delete Message</div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="delete-confirm-modal" class="modal-overlay" style="display:none; z-index:1001;">
        <div class="modal-content">
            <h3>Delete Message?</h3>
            <p>This action can be undone for 5 seconds.</p>
            <div style="display:flex; gap:10px; margin-top:20px; justify-content:center;">
                <button onclick="confirmDeletion()" class="danger-action"
                    style="padding:10px 20px !important; border-radius:8px !important;">Confirm</button>
                <button onclick="closeDeleteConfirm()" class="cancel-btn" style="margin:0;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- End Session Confirmation Modal (Replacement for JS Alert) -->
    <div id="end-session-confirm-modal" class="modal-overlay" style="display:none; z-index:1001;">
        <div class="modal-content" style="max-width: 400px;">
            <h3>End Session?</h3>
            <p style="margin-bottom: 20px; color: var(--text-secondary);">Save chat history before ending?</p>
            <div style="display:flex; flex-direction:column; gap:10px;">
                <button onclick="executeEndSession('save')" class="primary-action"
                    style="padding:12px !important; border-radius:8px !important; width:100% !important;">Save &
                    End</button>
                <button onclick="executeEndSession('delete')" class="danger-action"
                    style="padding:12px !important; border-radius:8px !important; width:100% !important;">Delete &
                    End</button>
                <button onclick="closeEndSessionModal()" class="cancel-btn"
                    style="padding:12px !important; border-radius:8px !important; width:100% !important; margin:0;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Undo Toast Notification -->
    <div id="undo-toast" class="undo-toast" style="display:none;">
        <span>Message deleted</span>
        <button onclick="undoDeletion()">UNDO</button>
    </div>

    <script src="node_modules/cropperjs/dist/cropper.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="chat.js"></script>
</body>

</html>